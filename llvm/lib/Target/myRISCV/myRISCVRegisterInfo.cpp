#include "myRISCVRegisterInfo.h"
#include "myRISCVSubtarget.h"
#include "llvm/CodeGen/MachineFunction.h"
#include "llvm/Support/raw_ostream.h"

#define GET_REGINFO_ENUM // if not include this, it will report missing some
                         // enum
#define GET_REGINFO_TARGET_DESC
#include "myRISCVGenRegisterInfo.inc" // for llvm::X1

using namespace llvm;

myRISCVRegisterInfo::myRISCVRegisterInfo(unsigned HwMode)
    : myRISCVGenRegisterInfo(myRISCV::X1, 0, 0, 0, HwMode) {}

const MCPhysReg *
myRISCVRegisterInfo::getCalleeSavedRegs(const MachineFunction *MF) const {
  return CSR_ILP32_LP64_SaveList; // generated by .td, CSR_LP32_SaveList is
                                  // in myRISCVGenRegisterInfo.inc, which is
                                  // made by CallingConv.td, CalleeSavedRegs.
}

BitVector
myRISCVRegisterInfo::getReservedRegs(const MachineFunction &MF) const {
  BitVector Reserved(getNumRegs());

  markSuperRegs(Reserved, myRISCV::X0);
  markSuperRegs(Reserved, myRISCV::X1);
  markSuperRegs(Reserved, myRISCV::X2);
  markSuperRegs(Reserved, myRISCV::X3);
  markSuperRegs(Reserved, myRISCV::X4);

  return Reserved;
}

bool myRISCVRegisterInfo::eliminateFrameIndex(MachineBasicBlock::iterator MI,
                                              int SPAdj, unsigned FIOperandNum,
                                              RegScavenger *RS) const {
  // TODO
}

Register
myRISCVRegisterInfo::getFrameRegister(const MachineFunction &MF) const {
  const TargetFrameLowering *TFI = getFrameLowering(MF);
  return TFI->hasFP(MF) ? myRISCV::X8 : myRISCV::X2;
}
